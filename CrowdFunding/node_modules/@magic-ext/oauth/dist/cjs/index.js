"use strict";var ae=Object.create;var I=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var k=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports),ue=(n,r)=>{for(var a in r)I(n,a,{get:r[a],enumerable:!0})},F=(n,r,a,m)=>{if(r&&typeof r=="object"||typeof r=="function")for(let h of se(r))!fe.call(n,h)&&h!==a&&I(n,h,{get:()=>r[h],enumerable:!(m=oe(r,h))||m.enumerable});return n};var W=(n,r,a)=>(a=n!=null?ae(ce(n)):{},F(r||!n||!n.__esModule?I(a,"default",{value:n,enumerable:!0}):a,n)),de=n=>F(I({},"__esModule",{value:!0}),n);var C=(n,r,a)=>new Promise((m,h)=>{var w=p=>{try{d(a.next(p))}catch(u){h(u)}},R=p=>{try{d(a.throw(p))}catch(u){h(u)}},d=p=>p.done?m(p.value):Promise.resolve(p.value).then(w,R);d((a=a.apply(n,r)).next())});var D=k((S,L)=>{(function(n,r){typeof S=="object"?L.exports=S=r():typeof define=="function"&&define.amd?define([],r):n.CryptoJS=r()})(S,function(){var n=n||function(r,a){var m=Object.create||function(){function e(){}return function(t){var c;return e.prototype=t,c=new e,e.prototype=null,c}}(),h={},w=h.lib={},R=w.Base=function(){return{extend:function(e){var t=m(this);return e&&t.mixIn(e),(!t.hasOwnProperty("init")||this.init===t.init)&&(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=w.WordArray=R.extend({init:function(e,t){e=this.words=e||[],t!=a?this.sigBytes=t:this.sigBytes=e.length*4},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,c=e.words,i=this.sigBytes,g=e.sigBytes;if(this.clamp(),i%4)for(var v=0;v<g;v++){var b=c[v>>>2]>>>24-v%4*8&255;t[i+v>>>2]|=b<<24-(i+v)%4*8}else for(var v=0;v<g;v+=4)t[i+v>>>2]=c[v>>>2];return this.sigBytes+=g,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=r.ceil(t/4)},clone:function(){var e=R.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],c=function(y){var y=y,A=987654321,B=4294967295;return function(){A=36969*(A&65535)+(A>>16)&B,y=18e3*(y&65535)+(y>>16)&B;var x=(A<<16)+y&B;return x/=4294967296,x+=.5,x*(r.random()>.5?1:-1)}},i=0,g;i<e;i+=4){var v=c((g||r.random())*4294967296);g=v()*987654071,t.push(v()*4294967296|0)}return new d.init(t,e)}}),p=h.enc={},u=p.Hex={stringify:function(e){for(var t=e.words,c=e.sigBytes,i=[],g=0;g<c;g++){var v=t[g>>>2]>>>24-g%4*8&255;i.push((v>>>4).toString(16)),i.push((v&15).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,c=[],i=0;i<t;i+=2)c[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new d.init(c,t/2)}},_=p.Latin1={stringify:function(e){for(var t=e.words,c=e.sigBytes,i=[],g=0;g<c;g++){var v=t[g>>>2]>>>24-g%4*8&255;i.push(String.fromCharCode(v))}return i.join("")},parse:function(e){for(var t=e.length,c=[],i=0;i<t;i++)c[i>>>2]|=(e.charCodeAt(i)&255)<<24-i%4*8;return new d.init(c,t)}},o=p.Utf8={stringify:function(e){try{return decodeURIComponent(escape(_.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return _.parse(unescape(encodeURIComponent(e)))}},f=w.BufferedBlockAlgorithm=R.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=o.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,c=t.words,i=t.sigBytes,g=this.blockSize,v=g*4,b=i/v;e?b=r.ceil(b):b=r.max((b|0)-this._minBufferSize,0);var y=b*g,A=r.min(y*4,i);if(y){for(var B=0;B<y;B+=g)this._doProcessBlock(c,B);var x=c.splice(0,y);t.sigBytes-=A}return new d.init(x,A)},clone:function(){var e=R.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s=w.Hasher=f.extend({cfg:R.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:512/32,_createHelper:function(e){return function(t,c){return new e.init(c).finalize(t)}},_createHmacHelper:function(e){return function(t,c){return new l.HMAC.init(e,c).finalize(t)}}}),l=h.algo={};return h}(Math);return n})});var $=k((U,q)=>{(function(n,r){typeof U=="object"?q.exports=U=r(D()):typeof define=="function"&&define.amd?define(["./core"],r):r(n.CryptoJS)})(U,function(n){return function(r){var a=n,m=a.lib,h=m.WordArray,w=m.Hasher,R=a.algo,d=[],p=[];(function(){function o(e){for(var t=r.sqrt(e),c=2;c<=t;c++)if(!(e%c))return!1;return!0}function f(e){return(e-(e|0))*4294967296|0}for(var s=2,l=0;l<64;)o(s)&&(l<8&&(d[l]=f(r.pow(s,1/2))),p[l]=f(r.pow(s,1/3)),l++),s++})();var u=[],_=R.SHA256=w.extend({_doReset:function(){this._hash=new h.init(d.slice(0))},_doProcessBlock:function(o,f){for(var s=this._hash.words,l=s[0],e=s[1],t=s[2],c=s[3],i=s[4],g=s[5],v=s[6],b=s[7],y=0;y<64;y++){if(y<16)u[y]=o[f+y]|0;else{var A=u[y-15],B=(A<<25|A>>>7)^(A<<14|A>>>18)^A>>>3,x=u[y-2],Z=(x<<15|x>>>17)^(x<<13|x>>>19)^x>>>10;u[y]=B+u[y-7]+Z+u[y-16]}var ee=i&g^~i&v,re=l&e^l&t^e&t,te=(l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22),ne=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),E=b+ne+ee+p[y]+u[y],ie=te+re;b=v,v=g,g=i,i=c+E|0,c=t,t=e,e=l,l=E+ie|0}s[0]=s[0]+l|0,s[1]=s[1]+e|0,s[2]=s[2]+t|0,s[3]=s[3]+c|0,s[4]=s[4]+i|0,s[5]=s[5]+g|0,s[6]=s[6]+v|0,s[7]=s[7]+b|0},_doFinalize:function(){var o=this._data,f=o.words,s=this._nDataBytes*8,l=o.sigBytes*8;return f[l>>>5]|=128<<24-l%32,f[(l+64>>>9<<4)+14]=r.floor(s/4294967296),f[(l+64>>>9<<4)+15]=s,o.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var o=w.clone.call(this);return o._hash=this._hash.clone(),o}});a.SHA256=w._createHelper(_),a.HmacSHA256=w._createHmacHelper(_)}(Math),n.SHA256})});var N=k((O,M)=>{(function(n,r){typeof O=="object"?M.exports=O=r(D()):typeof define=="function"&&define.amd?define(["./core"],r):r(n.CryptoJS)})(O,function(n){return function(){var r=n,a=r.lib,m=a.WordArray,h=r.enc,w=h.Base64={stringify:function(d){var p=d.words,u=d.sigBytes,_=this._map;d.clamp();for(var o=[],f=0;f<u;f+=3)for(var s=p[f>>>2]>>>24-f%4*8&255,l=p[f+1>>>2]>>>24-(f+1)%4*8&255,e=p[f+2>>>2]>>>24-(f+2)%4*8&255,t=s<<16|l<<8|e,c=0;c<4&&f+c*.75<u;c++)o.push(_.charAt(t>>>6*(3-c)&63));var i=_.charAt(64);if(i)for(;o.length%4;)o.push(i);return o.join("")},parse:function(d){var p=d.length,u=this._map,_=this._reverseMap;if(!_){_=this._reverseMap=[];for(var o=0;o<u.length;o++)_[u.charCodeAt(o)]=o}var f=u.charAt(64);if(f){var s=d.indexOf(f);s!==-1&&(p=s)}return R(d,p,_)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function R(d,p,u){for(var _=[],o=0,f=0;f<p;f++)if(f%4){var s=u[d.charCodeAt(f-1)]<<f%4*2,l=u[d.charCodeAt(f)]>>>6-f%4*2;_[o>>>2]|=(s|l)<<24-o%4*8,o++}return m.create(_,o)}}(),n.enc.Base64})});var ye={};ue(ye,{OAuthErrorCode:()=>z,OAuthExtension:()=>T,OAuthPayloadMethods:()=>P});module.exports=de(ye);var X=require("magic-sdk");var P=(r=>(r.ParseRedirectResult="magic_oauth_parse_redirect_result",r))(P||{}),z=(o=>(o.InvalidRequest="invalid_request",o.InvalidClient="invalid_client",o.InvalidScope="invalid_scope",o.InvalidGrant="invalid_grant",o.UnauthorizedClient="unauthorized_client",o.UnsupportedResponseType="unsupported_response_type",o.UnsupportedGrantType="unsupported_grant_type",o.UnsupportedTokenType="unsupported_token_type",o.AccessDenied="access_denied",o.ServerError="server_error",o.TemporarilyUnavailable="temporarily_unavailable",o))(z||{});var K=W($()),Y=W(N());var j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",G=typeof window!="undefined"&&!!window.crypto,le=G&&!!window.crypto.subtle;function pe(n){return Array.from(n).map(r=>j[r%j.length]).join("")}function J(n){let r=a=>a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(n instanceof ArrayBuffer){let a=new Uint8Array(n),m=Array.from(a).map(w=>String.fromCharCode(w)).join(""),h=btoa(m);return r(h)}return r(Y.default.stringify(n))}function he(n){return C(this,null,function*(){if(le){let r=new TextEncoder().encode(n);return crypto.subtle.digest("SHA-256",r).then(J)}return J((0,K.default)(n))})}function V(n){let r=new Uint8Array(n);if(G)window.crypto.getRandomValues(r);else for(let a=0;a<n;a+=1)r[a]=Math.floor(Math.random()*Math.floor(255));return pe(r)}function Q(){return C(this,null,function*(){let n=V(128),r=V(128),a=yield he(r);return{verifier:r,challenge:a,state:n}})}var T=class extends X.Extension.Internal{constructor(){super(...arguments);this.name="oauth";this.config={};this.compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1,"@magic-sdk/react-native-bare":!1,"@magic-sdk/react-native-expo":!1}}loginWithRedirect(a){return this.utils.createPromiEvent(m=>C(this,null,function*(){let{provider:h,query:w}=yield ve.call(this,a);window.location.href=new URL(`/v1/oauth2/${h}/start?${w}`,this.sdk.endpoint).href,m()}))}getRedirectResult(){let a=window.location.search,m=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",m),ge.call(this,a)}},H="oauth_redirect_metadata";function ve(n){return C(this,null,function*(){yield this.utils.storage.removeItem(H);let{provider:r,redirectURI:a,scope:m,loginHint:h}=n,{verifier:w,challenge:R,state:d}=yield Q(),p=JSON.stringify({verifier:w,state:d});return yield this.utils.storage.setItem(H,p),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(R)}`,`state=${encodeURIComponent(d)}`,`platform=${encodeURIComponent("web")}`,m&&`scope=${encodeURIComponent(m.join(" "))}`,a&&`redirect_uri=${encodeURIComponent(a)}`,h&&`login_hint=${encodeURIComponent(h)}`].reduce((_,o)=>o?`${_}&${o}`:_),provider:r,redirectURI:a}})}function ge(n){return this.utils.createPromiEvent((r,a)=>C(this,null,function*(){var _;let m=yield this.utils.storage.getItem(H),{verifier:h,state:w}=JSON.parse(m);this.utils.storage.removeItem(H);let R=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[n,h,w]),d=yield this.request(R),p=d,u=d;u.error&&a(this.createError(u.error,(_=u.error_description)!=null?_:"An error occurred.",{errorURI:u.error_uri,provider:u.provider})),r(p)}))}
//# sourceMappingURL=index.js.map
