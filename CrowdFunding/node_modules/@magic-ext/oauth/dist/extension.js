"use strict";var MagicOAuthExtension=(()=>{var pe=Object.create;var I=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames,z=Object.getOwnPropertySymbols,ge=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var L=(t,r,i)=>r in t?I(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,$=(t,r)=>{for(var i in r||(r={}))q.call(r,i)&&L(t,i,r[i]);if(z)for(var i of z(r))ye.call(r,i)&&L(t,i,r[i]);return t};var U=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),M=(t,r)=>{for(var i in r)I(t,i,{get:r[i],enumerable:!0})},j=(t,r,i,m)=>{if(r&&typeof r=="object"||typeof r=="function")for(let h of ve(r))!q.call(t,h)&&h!==i&&I(t,h,{get:()=>r[h],enumerable:!(m=he(r,h))||m.enumerable});return t};var D=(t,r,i)=>(i=t!=null?pe(ge(t)):{},j(r||!t||!t.__esModule?I(i,"default",{value:t,enumerable:!0}):i,t)),me=t=>j(I({},"__esModule",{value:!0}),t);var C=(t,r,i)=>new Promise((m,h)=>{var w=p=>{try{d(i.next(p))}catch(u){h(u)}},R=p=>{try{d(i.throw(p))}catch(u){h(u)}},d=p=>p.done?m(p.value):Promise.resolve(p.value).then(w,R);d((i=i.apply(t,r)).next())});var J=U((Ie,N)=>{N.exports=Magic});var F=U((O,K)=>{(function(t,r){typeof O=="object"?K.exports=O=r():typeof define=="function"&&define.amd?define([],r):t.CryptoJS=r()})(O,function(){var t=t||function(r,i){var m=Object.create||function(){function e(){}return function(n){var c;return e.prototype=n,c=new e,e.prototype=null,c}}(),h={},w=h.lib={},R=w.Base=function(){return{extend:function(e){var n=m(this);return e&&n.mixIn(e),(!n.hasOwnProperty("init")||this.init===n.init)&&(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=w.WordArray=R.extend({init:function(e,n){e=this.words=e||[],n!=i?this.sigBytes=n:this.sigBytes=e.length*4},toString:function(e){return(e||u).stringify(this)},concat:function(e){var n=this.words,c=e.words,a=this.sigBytes,g=e.sigBytes;if(this.clamp(),a%4)for(var v=0;v<g;v++){var x=c[v>>>2]>>>24-v%4*8&255;n[a+v>>>2]|=x<<24-(a+v)%4*8}else for(var v=0;v<g;v+=4)n[a+v>>>2]=c[v>>>2];return this.sigBytes+=g,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=r.ceil(n/4)},clone:function(){var e=R.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var n=[],c=function(y){var y=y,A=987654321,B=4294967295;return function(){A=36969*(A&65535)+(A>>16)&B,y=18e3*(y&65535)+(y>>16)&B;var b=(A<<16)+y&B;return b/=4294967296,b+=.5,b*(r.random()>.5?1:-1)}},a=0,g;a<e;a+=4){var v=c((g||r.random())*4294967296);g=v()*987654071,n.push(v()*4294967296|0)}return new d.init(n,e)}}),p=h.enc={},u=p.Hex={stringify:function(e){for(var n=e.words,c=e.sigBytes,a=[],g=0;g<c;g++){var v=n[g>>>2]>>>24-g%4*8&255;a.push((v>>>4).toString(16)),a.push((v&15).toString(16))}return a.join("")},parse:function(e){for(var n=e.length,c=[],a=0;a<n;a+=2)c[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new d.init(c,n/2)}},_=p.Latin1={stringify:function(e){for(var n=e.words,c=e.sigBytes,a=[],g=0;g<c;g++){var v=n[g>>>2]>>>24-g%4*8&255;a.push(String.fromCharCode(v))}return a.join("")},parse:function(e){for(var n=e.length,c=[],a=0;a<n;a++)c[a>>>2]|=(e.charCodeAt(a)&255)<<24-a%4*8;return new d.init(c,n)}},o=p.Utf8={stringify:function(e){try{return decodeURIComponent(escape(_.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return _.parse(unescape(encodeURIComponent(e)))}},f=w.BufferedBlockAlgorithm=R.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=o.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var n=this._data,c=n.words,a=n.sigBytes,g=this.blockSize,v=g*4,x=a/v;e?x=r.ceil(x):x=r.max((x|0)-this._minBufferSize,0);var y=x*g,A=r.min(y*4,a);if(y){for(var B=0;B<y;B+=g)this._doProcessBlock(c,B);var b=c.splice(0,y);n.sigBytes-=A}return new d.init(b,A)},clone:function(){var e=R.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s=w.Hasher=f.extend({cfg:R.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var n=this._doFinalize();return n},blockSize:512/32,_createHelper:function(e){return function(n,c){return new e.init(c).finalize(n)}},_createHmacHelper:function(e){return function(n,c){return new l.HMAC.init(e,c).finalize(n)}}}),l=h.algo={};return h}(Math);return t})});var G=U((H,Y)=>{(function(t,r){typeof H=="object"?Y.exports=H=r(F()):typeof define=="function"&&define.amd?define(["./core"],r):r(t.CryptoJS)})(H,function(t){return function(r){var i=t,m=i.lib,h=m.WordArray,w=m.Hasher,R=i.algo,d=[],p=[];(function(){function o(e){for(var n=r.sqrt(e),c=2;c<=n;c++)if(!(e%c))return!1;return!0}function f(e){return(e-(e|0))*4294967296|0}for(var s=2,l=0;l<64;)o(s)&&(l<8&&(d[l]=f(r.pow(s,1/2))),p[l]=f(r.pow(s,1/3)),l++),s++})();var u=[],_=R.SHA256=w.extend({_doReset:function(){this._hash=new h.init(d.slice(0))},_doProcessBlock:function(o,f){for(var s=this._hash.words,l=s[0],e=s[1],n=s[2],c=s[3],a=s[4],g=s[5],v=s[6],x=s[7],y=0;y<64;y++){if(y<16)u[y]=o[f+y]|0;else{var A=u[y-15],B=(A<<25|A>>>7)^(A<<14|A>>>18)^A>>>3,b=u[y-2],se=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;u[y]=B+u[y-7]+se+u[y-16]}var ce=a&g^~a&v,fe=l&e^l&n^e&n,ue=(l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22),de=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),W=x+de+ce+p[y]+u[y],le=ue+fe;x=v,v=g,g=a,a=c+W|0,c=n,n=e,e=l,l=W+le|0}s[0]=s[0]+l|0,s[1]=s[1]+e|0,s[2]=s[2]+n|0,s[3]=s[3]+c|0,s[4]=s[4]+a|0,s[5]=s[5]+g|0,s[6]=s[6]+v|0,s[7]=s[7]+x|0},_doFinalize:function(){var o=this._data,f=o.words,s=this._nDataBytes*8,l=o.sigBytes*8;return f[l>>>5]|=128<<24-l%32,f[(l+64>>>9<<4)+14]=r.floor(s/4294967296),f[(l+64>>>9<<4)+15]=s,o.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var o=w.clone.call(this);return o._hash=this._hash.clone(),o}});i.SHA256=w._createHelper(_),i.HmacSHA256=w._createHmacHelper(_)}(Math),t.SHA256})});var X=U((k,Q)=>{(function(t,r){typeof k=="object"?Q.exports=k=r(F()):typeof define=="function"&&define.amd?define(["./core"],r):r(t.CryptoJS)})(k,function(t){return function(){var r=t,i=r.lib,m=i.WordArray,h=r.enc,w=h.Base64={stringify:function(d){var p=d.words,u=d.sigBytes,_=this._map;d.clamp();for(var o=[],f=0;f<u;f+=3)for(var s=p[f>>>2]>>>24-f%4*8&255,l=p[f+1>>>2]>>>24-(f+1)%4*8&255,e=p[f+2>>>2]>>>24-(f+2)%4*8&255,n=s<<16|l<<8|e,c=0;c<4&&f+c*.75<u;c++)o.push(_.charAt(n>>>6*(3-c)&63));var a=_.charAt(64);if(a)for(;o.length%4;)o.push(a);return o.join("")},parse:function(d){var p=d.length,u=this._map,_=this._reverseMap;if(!_){_=this._reverseMap=[];for(var o=0;o<u.length;o++)_[u.charCodeAt(o)]=o}var f=u.charAt(64);if(f){var s=d.indexOf(f);s!==-1&&(p=s)}return R(d,p,_)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function R(d,p,u){for(var _=[],o=0,f=0;f<p;f++)if(f%4){var s=u[d.charCodeAt(f-1)]<<f%4*2,l=u[d.charCodeAt(f)]>>>6-f%4*2;_[o>>>2]|=(s|l)<<24-o%4*8,o++}return m.create(_,o)}}(),t.enc.Base64})});var Be={};M(Be,{default:()=>be});var oe=D(J());var E={};M(E,{OAuthErrorCode:()=>V,OAuthPayloadMethods:()=>T});var T=(r=>(r.ParseRedirectResult="magic_oauth_parse_redirect_result",r))(T||{}),V=(o=>(o.InvalidRequest="invalid_request",o.InvalidClient="invalid_client",o.InvalidScope="invalid_scope",o.InvalidGrant="invalid_grant",o.UnauthorizedClient="unauthorized_client",o.UnsupportedResponseType="unsupported_response_type",o.UnsupportedGrantType="unsupported_grant_type",o.UnsupportedTokenType="unsupported_token_type",o.AccessDenied="access_denied",o.ServerError="server_error",o.TemporarilyUnavailable="temporarily_unavailable",o))(V||{});var te=D(G()),ne=D(X());var Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",ie=typeof window!="undefined"&&!!window.crypto,_e=ie&&!!window.crypto.subtle;function we(t){return Array.from(t).map(r=>Z[r%Z.length]).join("")}function ee(t){let r=i=>i.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(t instanceof ArrayBuffer){let i=new Uint8Array(t),m=Array.from(i).map(w=>String.fromCharCode(w)).join(""),h=btoa(m);return r(h)}return r(ne.default.stringify(t))}function Re(t){return C(this,null,function*(){if(_e){let r=new TextEncoder().encode(t);return crypto.subtle.digest("SHA-256",r).then(ee)}return ee((0,te.default)(t))})}function re(t){let r=new Uint8Array(t);if(ie)window.crypto.getRandomValues(r);else for(let i=0;i<t;i+=1)r[i]=Math.floor(Math.random()*Math.floor(255));return we(r)}function ae(){return C(this,null,function*(){let t=re(128),r=re(128),i=yield Re(r);return{verifier:r,challenge:i,state:t}})}var S=class extends oe.Extension.Internal{constructor(){super(...arguments);this.name="oauth";this.config={};this.compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1,"@magic-sdk/react-native-bare":!1,"@magic-sdk/react-native-expo":!1}}loginWithRedirect(i){return this.utils.createPromiEvent(m=>C(this,null,function*(){let{provider:h,query:w}=yield Ae.call(this,i);window.location.href=new URL(`/v1/oauth2/${h}/start?${w}`,this.sdk.endpoint).href,m()}))}getRedirectResult(){let i=window.location.search,m=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",m),xe.call(this,i)}},P="oauth_redirect_metadata";function Ae(t){return C(this,null,function*(){yield this.utils.storage.removeItem(P);let{provider:r,redirectURI:i,scope:m,loginHint:h}=t,{verifier:w,challenge:R,state:d}=yield ae(),p=JSON.stringify({verifier:w,state:d});return yield this.utils.storage.setItem(P,p),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(R)}`,`state=${encodeURIComponent(d)}`,`platform=${encodeURIComponent("web")}`,m&&`scope=${encodeURIComponent(m.join(" "))}`,i&&`redirect_uri=${encodeURIComponent(i)}`,h&&`login_hint=${encodeURIComponent(h)}`].reduce((_,o)=>o?`${_}&${o}`:_),provider:r,redirectURI:i}})}function xe(t){return this.utils.createPromiEvent((r,i)=>C(this,null,function*(){var _;let m=yield this.utils.storage.getItem(P),{verifier:h,state:w}=JSON.parse(m);this.utils.storage.removeItem(P);let R=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[t,h,w]),d=yield this.request(R),p=d,u=d;u.error&&i(this.createError(u.error,(_=u.error_description)!=null?_:"An error occurred.",{errorURI:u.error_uri,provider:u.provider})),r(p)}))}Object.assign(S,$({},E));var be=S;return me(Be);})();
if (MagicOAuthExtension && MagicOAuthExtension.default != null) { MagicOAuthExtension = Object.assign(MagicOAuthExtension.default, MagicOAuthExtension); delete MagicOAuthExtension.default; }
